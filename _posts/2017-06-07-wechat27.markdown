---                                   
layout:     post      
title:      "20170607-离线支付"                                     
date:       2017-06-06 19:00:00                                     
author:     "PaymentGroup"                                     
header-img: "img/post-bg-wechat.jpg"                                     
---   

> 今日无专题分享

## 一、支付路由及资金调拨

Q1：陆金所的资金调拨如何实现的？
A1：通过银行转的，目前支持兴业银行，中信银行，浦发银行，微众银行，民生银行，恒丰银行，新网银行。

Q2：流量如何分配？
A1：订单轮循

Q3：你们接入银行出款通道，银行有提供业务对账文件么？
A1：出款是没有对账文件的
A2：有些有，有些无。回盘文件肯定是有的，但t1的对账单不一定都有
A3：出款一般走实时代付或者批量代付，一般银行第二天会出对账文件的。

Q4：哪些银行有出款业务对账文件？
A1：工农中建都有

Q5：出款银行返回结果不明确的，你们一般处理时间多长？
A1：银行都有交易查询或者对账接口吧，可以问下银行
A2：目前都是通过查询，不明确的第二天核对资金确认最终状态，交易越来越多，处理时效就越来越差了。
A3：银行是走大小额系统吧，一般15分钟也会返回结果了吧。银行出现退票是另外的处理情况。
A4：我们一般是当天会持续地发查询，一般是2的N次方秒查一次，第一次是2S查一次，第二次是４S查一次，后续再８S，１６S，以此类推，我们目前最多是查８次还是多少次我忘记了。如果这种还是无法得到明确的结果，出款类交易属于待确认的，我们会把这笔交易认为是成功的，以保证资金安全，T+1日再跟银行进行对账，根据对账结果，如果有差错，再进行差错处理。
![图片](http://wechat.lixf.cn/img/20170607_083309.png)
A5：认为成功实际没出，那用户会投诉，解释 银行退票？还有这也会增加结算人员工作量，尤其没有业务对账文件的时候。

## 二、产品、运营职责

Q1：产品和营运工作的重点各是什么？ 或者工作的目标和考察的内容各是什么？
A1：产品负责生孩子，运营负责养孩子
A2：内：优化支付产品（收银台，支付后台管理等） 外：满足业务方各类支付需求
A3：小公司产品还担着项目管理的工作
A4：处在产品和用户之间的营运 一方面需要开发用户群 向用户推销产品 一方面需要发掘发现用户需求 帮助产品完善功能
A5：运营分为很多种：市场运营，活动运营，内容运营等等。有些公司运营和产品不分家。产品负责把产品做出来，其需求来源，灵感，创新等都不能脱离用户，而运营工作是离市场和用户最近的。产品要评估看新的功能是否是用户想要的，也需要通过数据运营来验证。 数据运营也就是昨天驴妈妈那位PM分享的。数据运营又分两部分：一部分是为了改进产品功能，一部分是为了调整营销活动。
Q2：市场运营用户运营互动运营内容运营这些都是一个东西吧 或者说一件事的几个步骤？
A1：侧重点不一样。市场运营：品牌、行业。用户运营：偏重用户数据，用户拜访，沟通，客服。内容运营：就是社群，有些产品有内容导向的社区，直播，公众号之类的。这些划分不是绝对的，有重合有侧重。
A2：这些东西都太大、太空，就我之前做聚合支付的情况，最好的办法就是降低费率。做P2P的情况来看，最好的办法就是送钱，蹭银行大腿。其他的运营方式都是缓慢的过程，所有的数据运营都是要在这些之后才做的，都是后话了。
A3：并不空，小公司可以从社群做起
A4：是啊，但是好多都没有章法，都是说砸钱，但这解决不了根本问题，用户基本上都是卷钱就走人了，所以，感觉还是自己的产品要自成体系，让用户切实离不开你的产品。

## 三：宝付上市

> 上主板，IPO暂缓了。宝付持有全国互联网支付牌照，前不久有获批跨境外币和人民币支付许可
> [刚刚，马云拿下中国联通！全世界沸腾](http://mp.weixin.qq.com/s?__biz=MjM5NDQyOTYxNA==&mid=2650837944&idx=4&sn=d283a700e49850163c5cb4fb2fa8539b&chksm=bd73dc798a04556fad44aeb9aa890908aa55ed06a4e4d09b1742d1e71cf14a27e6c55cb5b454&mpshare=1&scene=1&srcid=0607hymyJs6fD5NFFOCWlt1t#rd)

## 四、移动支付是否可以脱网

Q1：移动支付能不能做到不联网？意思就是收钱机器和付钱机器都不联网，能不能做到？
A1：至少有一个要在线吧
A2：NFC可以。移动支付分为远程和近场，近场的就是不联网方式下进行支付
A3：联通以前推过空中圈存
A4：离线钱包就可以做到，现有的公交卡不就是离线支付
A5：有圈存模式，余额直接写在卡上。

Q2：银行卡不也有个脱机账户？
A1：电子现金账户...不过体验很差，需要圈存...

Q3：不连网的支付交易，怎么做到余额记录的，怎么知道扣款是否成功的？
A1：余额就在卡上

Q4：脱机怎么保证交易事务安全风控这些 靠nfc的安全保证？
A1：对，NFC本身就是小额支付，风险不大

## 五、公交卡消费模式

Q1：求分享公交卡的工作原理
A1：公交车晚上再集中上报数据
A2：公交车上那个是脱机的
A3：公交卡其实就是一种虚拟电子钱包，就像银行卡刷卡扣费一样，只是卡片的结构不一样，银行卡属于磁条卡，公交卡属于芯片卡，就安全性而言后者优势较大。那是感应卡，卡里有个芯片，但没有电源，当卡靠近读卡器时，感应天线接受到电磁辐射，产生能量以供芯片工作（芯片功率很低的）。
	因为你买IC卡时你卡上的信息已经存储到系统里了 当你乘车时刷卡机就读取信息扣除相应的金额存储在刷卡机里 然后公交公司在派人提取刷卡机里的信息。
A4：圈存时，圈存机联网，将额度写入卡芯片的电子现金账户里面，这样卡就有余额了；支付时，不需要任何联网，终端与卡片交互，扣除电子现金账户余额；终端定期（一般会在晚上，或者通过批结算等操作来触发）将脱机交易信息，联网上送到后台，直至发卡机构，这时发卡机构才晓得，这张卡的电子现金账户扣钱了...

Q2：在一辆车里有两个刷卡机，是联网的吧？
A1：一辆公交车内部的两台机器，属于串联交易
A2：好像是用RJ45端口进行串口数据交互

Q3：公交卡具体的消费流程是怎样的？
A1：读卡器开始寻卡，读到IC卡，校验卡密钥，然后写卡（不同业务类型写不同卡片区域），写卡后再次读卡确认，返回交易结果
A2：地铁卡里有写你的进站站点，读卡后，读卡器把进站站点返回到PC系统，系统计算价格后告诉读卡器，进行出站业务，扣费**元，读卡器把相关信息写到地铁卡里
A3：对于芯片其实是有两个账户的，一个是本地账户，存在卡上，另一个影子账户，存在远程，理论上这两个账户的钱是一样的。另有资金账户，消费前先将资金账户的钱转到影子账户，卡片再通过联机设备将钱写入到卡中。消费的时候，中间有安全校验，完成后，就扣钱，扣的是卡上的钱，（当然，还可以冲正），商户拿着最终的消费记录上传给发卡机构，发卡机构进行结算，将扣影子账户的钱。
	地铁这块我不是特别清楚，但说联机我不太同意，联机方案风险太大，出现问题所有人都进不了站。
A4：地铁AFC系统里读卡器正常是联机的，如果出现断网，也支持脱机交易，恢复网络后上传交易和下载参数。也有更新，虽然频率不是很高，一般比如启动去联网下载一下最新的计费规则，黑名单，系统参数什么的
A5：每笔交易过程中不联后台，交易完成后马上上传交易信息即可。联机脱机其实应该说是设备的状态，交易过程独立看应该算都是脱机交易的。
A6：我理解和饭卡的原理一样。
	1. 用户在商户店内选择商品或服务； 
	2. 用户到商户收银台结账； 
	3. 商户在现场脱机受理终端（POS）输入消费金融，通过近场通信技术，向移动终端／智能卡发起账户扣款请求； 
	4. 移动终端／智能卡收到扣款请求，进行扣款的鉴权，通过后直接在其离线钱包中扣款，并返回扣款应答给受理终端； 
	5. 完成支付； 
	6. 脱机现场受理终端定时上传交易数据，第三方支付机构每日与特约商户对账； 
	7. 第三方支付机构的结算部门按商户的结算周期，根据系统的结算数据，向银行发起付款请求
 

Q4：进地铁站的时候 可能刷卡机给我卡打了个标识 然后出站的时候刷卡机读到了这个标识 然后根据既定程序进行扣费？
A1：原理上是这样
A2：卡内估计是存储余额，进站站名，时间，密钥等信息， 到结算是，取出这些信息按照本地库的计费模型进行核算。
A3：卡内可存储的东西很多

## 六、征收的手续费设计思路

Q1：你们在设计系统的时候，要征收的各种手续费这块有没有什么设计思路啊？
A1：我们是实时分账的，再将手续费归类，分发到各个手续费子账户
A2：收费先确定收费方式:内收，外收。 再确定计费模型: 按笔，按比例，区间等。
A3：支付手续费正常的就是产品上设置内收，外收，征收方式，还有其他的处理费用
Q2：如果有多种需要征收的手续费，怎么设计会便于扩展？
A1：多种手续费模式及模型都不一样，所以应该是分开计费
A2：费用一般是和交易关联，一个产品支持多个交易，交易对计费是一对多映射关系

Q3：我现在纠结的是不想去交易订单表里面扩字段，我感觉这样每次新增一个费用就要扩展一个字段。但是不去订单表里面扩展字段我又没办法统计。我要统计的是一个订单总的各种支出，总手续费A, B,C,D这样
A1：将计费模型变成计费标准，一个标准里含多个模型，订单表中记录计费标准。扩展不应该字段扩展，扩展记录

Q4：你说的计费标准能给我解释一下不？
A1：就是多个计费方式自定义成一个组。数据用k,v方式将不同的计费方式组合。因为订单表要稳定，只有一个字段，所以这个字段应该指向一个list方式聚合对像

> 延伸阅读: [Paying集成支付系统](http://2029438207.scene.eqxiu.com/s/tWqa78yB?eqrcode=1&from=timeline&isappinstalled=0)
